> author: 冯秋翼
# 网络部分
## 依赖
1. boost::asio

    实现tcp异步通讯

2. boost::serialization

    实现快速、跨平台、动态数组支持、指针支持的可靠序列化

3. boost::thread

    实现多线程编程

3. rapidJson

    实现Json Dom解析

4. CCHttpRequest

    实现Http客户端

5. Spring

    实现Http服务端

## 网络模块

1. 联机平台模块：服务端：Spring，客户端：CCHttpRequest

    联机平台主要解决了局域网游戏需要client玩家输入host玩家ip的尴尬情况，同时也负责一些游戏信息，比如记录房间玩家人数，名称，在线玩家数等

2. 聊天室模块：boost::asio

    在游戏房间内，玩家可以自由交流。并且聊天室模块也负责广播一些游戏的GM(游戏管理员)消息，实现游戏房间前端逻辑。

3. 游戏帧同步模块：boost::asio

    游戏联机的主要模块，解决联机游戏本身的画面、数据同步问题。

## 联机平台

### 实现逻辑
![联机平台时序图](联机平台时序图.jpg)

## 聊天室模块

实现玩家间的即时通讯(没啥好讲的，放几张图片吧)

## 帧同步模块

同步游戏帧的模块，在本游戏中分为
1. 同步玩家以及玩家的状态、动作
2. 同步游戏中全局的怪物信息
3. 同步游戏中全局的物品信息

### 实现逻辑

1. 所有玩家将自己的游戏状态上传至host机
2. host经过一定的merge操作合并出一个统一的状态
3. 将数据序列化发送至各玩家
4. 玩家读取数据并绘制游戏图像
5. 在一定的时间间隔后重新进入状态1

### 优化

1. 每个数据包都有所有玩家的状态，但玩家不从数据包中读取自己的游戏状态。因为数据包总会有延迟，对于玩家本身来说总时落后的。
2. 开始采用异步方式，后来发现异步方式发、读消息不及时(消息队列机制)，后来采用同步方式。
3. 为保证人物动作连贯，在大部分数据包中只同步角色运动的方向和速度，只有当角色位置和数据包的位置相差大于一阈值时才会对绝对位置进行同步。
4. 使用生产者-消费者模式，多个线程负责读取并产生数据包放入队列中，多个线程负责从队列中拿去并发送数据包，并对队列进行加锁保证线程安全。

### 不足

？？？